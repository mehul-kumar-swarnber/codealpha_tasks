<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taskly - Dashboard</title>
  <link rel="shortcut icon" href="assets/logo/ChatGPT_Image_Jul_6__2025__12_17_50_PM-removebg-preview.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(to right, #eef2f7, #f7f9fc);
      color: #2d3e50;
      padding: 40px 20px;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      position: relative;
      overflow: hidden;
    }

    .floating-image {
      position: absolute;
      width: 60px;
      animation: float 6s ease-in-out infinite;
      opacity: 0.7;
      z-index: 0;
    }

    .floating-image:nth-child(1) {
      top: 10%;
      left: 5%;
    }

    .floating-image:nth-child(2) {
      top: 20%;
      right: 5%;
      animation-delay: 1s;
    }

    .floating-image:nth-child(3) {
      bottom: 15%;
      left: 10%;
      animation-delay: 2s;
    }

    .floating-image:nth-child(4) {
      bottom: 5%;
      right: 8%;
      animation-delay: 3s;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-20px);
      }
    }


    .container {
      max-width: 700px;
      margin: auto;
      background: #ffffff;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.06);
      position: relative;
      overflow: hidden;
    }

    .dashboard-layout {
      display: flex;
      gap: 40px;
      align-items: flex-start;
      z-index: 1;
      position: relative;
    }

    .sidebar {
      width: 300px;
      background: #ffffff;
      padding: 30px 20px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.05);
      max-height: 600px;
      overflow-y: auto;
    }

    .sidebar h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #5b8ad6;
    }

    .sidebar ul {
      list-style: disc;
      padding-left: 20px;
      color: #34495e;
      font-size: 15px;
      line-height: 1.6;
    }

    h1 {
      font-size: 34px;
      margin-bottom: 20px;
      color: #34495e;
      text-align: center;
      background: linear-gradient(90deg, #5b8ad6, #a2bff0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
    }

    ul#projectList {
      list-style: none;
      margin-top: 20px;
      padding: 0;
    }

    ul#projectList li {
      margin-bottom: 14px;
      transition: transform 0.2s ease;
    }

    ul#projectList li:hover {
      transform: scale(1.02);
    }

    ul#projectList a {
      display: block;
      padding: 14px 18px;
      background-color: #eef3f8;
      border-radius: 12px;
      text-decoration: none;
      color: #2c3e50;
      font-weight: 500;
      transition: background 0.25s ease;
      flex: 1;
    }

    ul#projectList a:hover {
      background-color: #dbe8f8;
    }

    .form-group {
      display: flex;
      margin-top: 30px;
      gap: 12px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ccd6e0;
      border-radius: 10px;
      font-size: 15px;
      background-color: #f9fbfd;
      transition: box-shadow 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #7ca7d9;
      background-color: #fff;
      box-shadow: 0 0 0 3px rgba(91, 138, 214, 0.2);
    }

    button {
      padding: 12px 20px;
      background-color: #5b8ad6;
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.1s;
    }

    button:hover {
      background-color: #4976bd;
      transform: scale(1.03);
    }

    .footer {
      text-align: center;
      margin-top: 50px;
      font-size: 14px;
      color: #7f8c8d;
    }

    .delete-button {
      background: #e74c3c;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 14px;
      color: #fff;
      border: none;
      cursor: pointer;
      margin-left: 10px;
      transition: background 0.3s;
    }

    .delete-button:hover {
      background: #c0392b;
    }

    .project-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f1f6fc;
      padding: 10px 14px;
      border-radius: 12px;
    }
  </style>
</head>

<body>
  <div id="topBar" style="
  position: absolute;
  top: 20px;
  left: 40px;
  right: 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 2;
">
    <div style="display: flex; align-items: center; gap: 10px;">
      <img src="assets/logo/ChatGPT_Image_Jul_6__2025__12_17_50_PM-removebg-preview.png" alt="Taskly Logo" style="height: 40px;" />
      <h2 style="margin: 0; font-size: 22px; color: #3a4e66;">Taskly | Dashboard</h2>
    </div>
  </div>

  <img src="assets/icons/clipboard/ChatGPT Image Jul 6, 2025, 08_47_52 AM.png" class="floating-image" alt="Clipboard">
  <img src="assets/icons/calendar/ChatGPT_Image_Jul_6__2025__08_50_56_AM-removebg-preview.png" class="floating-image"
    alt="Calendar">
  <img src="assets/icons/checklist/ChatGPT_Image_Jul_6__2025__09_02_42_AM-removebg-preview.png" class="floating-image"
    alt="Checklist">
  <img src="assets/icons/task/ChatGPT_Image_Jul_6__2025__09_09_56_AM-removebg-preview.png" class="floating-image"
    alt="Task">

  <div class="dashboard-layout">
    <div class="container">
      <h1>üìÇ My Projects</h1>

      <ul id="projectList"></ul>

      <div class="form-group">
        <input type="text" id="projectName" placeholder="Enter new project name" />
        <button onclick="createProject()">Create</button>
      </div>

      <div class="footer">Taskly ¬© 2025</div>
    </div>

    <div class="sidebar">
      <h2>üöÄ Stay Motivated</h2>
      <div id="quoteBox" style="font-size: 15px; color: #34495e; line-height: 1.6;"></div>
      <div id="taskbot" style="margin-top: 30px;">
        <h2>ü§ñ TaskBot Assistant</h2>
        <div id="chatWindow"
          style="background: #f4f4f4; padding: 15px; height: 200px; overflow-y: auto; border-radius: 8px; margin-bottom: 10px;">
        </div>
        <input id="chatInput" type="text" placeholder="Ask something like 'What should I do first?'"
          style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc;">
      </div>
    </div>

    <script>
      const token = localStorage.getItem('token');
      const headers = { 'Authorization': token, 'Content-Type': 'application/json' };

      fetch('http://localhost:5000/api/projects', { headers })
        .then(res => res.json())
        .then(projects => {
          const list = document.getElementById('projectList');
          projects.forEach(p => {
            const li = document.createElement('li');
            li.innerHTML = `
          <div class="project-entry">
          <a href="board.html?projectId=${p._id}">${p.name}</a>
          <button class="delete-button" onclick="deleteProject('${p._id}')">üóë</button>
          </div>`;

            list.appendChild(li);
          });
        });

      function createProject() {
        const name = document.getElementById('projectName').value.trim();
        if (!name) return;

        fetch('http://localhost:5000/api/projects', {
          method: 'POST',
          headers,
          body: JSON.stringify({ name })
        }).then(() => location.reload());
      }

      function deleteProject(projectId) {
        if (!confirm("Are you sure you want to delete this project?")) return;

        fetch(`http://localhost:5000/api/projects/${projectId}`, {
          method: 'DELETE',
          headers
        })
          .then(res => {
            if (res.status === 204) location.reload();
            else return res.json().then(err => alert(err.error || 'Failed to delete'));
          });
      }
      function parseJwt(token) {
        try {
          return JSON.parse(atob(token.split('.')[1]));
        } catch (e) {
          return null;
        }
      }

      function updateTopBar() {
        const topBar = document.getElementById("topBar");
        const token = localStorage.getItem("token");

        const leftSection = `
    <div style="display: flex; align-items: center; gap: 10px;">
      <img src="assets/logo/ChatGPT_Image_Jul_6__2025__12_17_50_PM-removebg-preview.png" alt="Taskly Logo" style="height: 40px;" />
      <h2 style="margin: 0; font-size: 22px; color: #3a4e66;">Taskly | Dashboard</h2>
    </div>
  `;

        let rightSection = ``;
        if (!token) {
          rightSection = `
      <button onclick="window.location.href='index.html'" 
        style="padding: 10px 16px; background: #5b8ad6; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
        Login
      </button>`;
        } else {
          const decoded = parseJwt(token);
          const name = decoded?.name || "User";
          rightSection = `
      <span style="margin-right: 12px; font-weight: 600; color: #2d3e50;">üë§ ${name}</span>
      <button onclick="logout()" 
        style="padding: 10px 16px; background: #e74c3c; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
        Logout
      </button>`;
        }

        topBar.innerHTML = `${leftSection}<div>${rightSection}</div>`;
      }
      function logout() {
        localStorage.removeItem('token');
        window.location.href = 'index.html';
      }

      updateTopBar();
      const motivationalQuotes = [
        "Start small, think big, act now.",
        "Your future is created by what you do today.",
        "Focus on being productive instead of busy.",
        "Don't watch the clock ‚Äî do what it does. Keep going.",
        "Success is the sum of small efforts repeated daily.",
        "You don‚Äôt have to be great to start, but you have to start to be great.",
        "Discipline is the bridge between goals and accomplishment.",
        "Push yourself, because no one else is going to do it for you.",
        "Dream big. Start now.",
        "A little progress each day adds up to big results."
      ];

      function showRandomQuote() {
        const quoteBox = document.getElementById('quoteBox');
        let lastQuote = "";

        function updateQuote() {
          let newQuote;
          do {
            newQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
          } while (newQuote === lastQuote);

          lastQuote = newQuote;
          quoteBox.textContent = newQuote;
        }

        updateQuote();
        setInterval(updateQuote, 5000);
      }
      document.getElementById("chatInput").addEventListener("keypress", async e => {
        if (e.key !== "Enter") return;
        const input = e.target.value.trim();
        if (!input) return;
        const cw = document.getElementById("chatWindow");
        cw.innerHTML += `<div><strong>You:</strong> ${input}</div>`;
        e.target.value = "";

        if (/what should I do first/i.test(input)) {
          const suggestion = await getBestTask();
          cw.innerHTML += `<div><strong>Bot:</strong> ${suggestion}</div>`;
        } else {
          cw.innerHTML += `<div><strong>Bot:</strong> Try asking ‚ÄúWhat should I do first?‚Äù</div>`;
        }
        cw.scrollTop = cw.scrollHeight;
      });

      async function getBestTask() {
        try {
          const headers = {
            'Authorization': localStorage.getItem('token'),
            'Content-Type': 'application/json'
          };
          const projectRes = await fetch("http://localhost:5000/api/projects", { headers });
          const projects = await projectRes.json();
          let allTasks = [];

          for (const project of projects) {
            const taskRes = await fetch(`http://localhost:5000/api/tasks/${project._id}`, { headers });
            const projectTasks = await taskRes.json();
            projectTasks.forEach(task => {
              allTasks.push({ ...task, projectName: project.name });
            });
          }

          if (allTasks.length === 0) return "You have no tasks. Time to create one!";
          const pending = allTasks.filter(t => t.status !== "Done");

          if (pending.length === 0) return "All tasks are done‚Äîcongrats!";

          pending.sort((a, b) => {
            const priorityOrder = { "High": 0, "Medium": 1, "Low": 2 };
            const dateA = new Date(a.dueDate || "9999-12-31");
            const dateB = new Date(b.dueDate || "9999-12-31");
            return priorityOrder[a.priority] - priorityOrder[b.priority] || dateA - dateB;
          });

          const best = pending[0];
          const dueText = best.dueDate ? `due ${new Date(best.dueDate).toDateString()}` : "no deadline";
          return `üëâ Try "${best.title}" (Project: ${best.projectName}) ‚Äî priority ${best.priority}, ${dueText}.`;

        } catch (err) {
          return "Can't fetch tasks right now‚Äîcheck your connection.";
        }
      }


      showRandomQuote();
    </script>

</body>

</html>